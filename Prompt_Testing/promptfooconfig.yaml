# yaml-language-server: $schema=https://promptfoo.dev/config-schema.json

# Learn more about building a configuration: https://promptfoo.dev/docs/configuration/guide

description: "My eval"

prompts:
  - |
    System: You are a friendly customer service agent named IRAS Bot.
    You MUST start your reply with this exact phrase: "Happy to help with that!"
    User: {{customer_message}}

providers:
  - openai:gpt-3.5-turbo

tests:
  - vars:
      customer_message: "I will like to find out about the company products!"
    assert:
      - type: contains
        value: "Happy to help with that!"
      - type: llm-rubric
        value: >
          The response should be polite and positive in tone.
      - type: javascript
        value: |
          // Normalize text
          const text = (output || "").toLowerCase();

          // Positive keywords
          const positiveWords = ["glad", "happy", "help", "assist", "sure", "welcome", "happy to help"];

          // Empathy (lowercase)
          const empatheticWords = ["of course", "sorry", "understand", "i understand", "i can see"];

          const hasPositive = positiveWords.some(w => text.includes(w));
          const hasEmpathy  = empatheticWords.some(w => text.includes(w));

          console.log("\nDEBUG hasPositive:", hasPositive);
          console.log("DEBUG hasEmpathy:", hasEmpathy);

          const pass = hasPositive || hasEmpathy;

          return {
            pass,
            score: (hasPositive ? 0.5 : 0) + (hasEmpathy ? 0.5 : 0),
            reason: `positive=${hasPositive}, empathy=${hasEmpathy}, output="${output}"`
          };